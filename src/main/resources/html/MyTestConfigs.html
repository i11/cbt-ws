<html>

<head>
<title>User test configurations</title>
<link rel="stylesheet" href="/jqueryui/themes/base/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="/jqueryui/ui/jquery-ui.js"></script>
<script src="/js/cbtclient.js"></script>
<script src="/js/common.js"></script>
</head>

<body onload="onLoad();">

	<script type="text/javascript">
		var testRuns;
		function onLoad() {
			loadHeader();

			console.log("loading");
			// Load list of test runs
			$.ajax({
				type : 'GET',
				url : rootURL + '/testconfig',
				dataType : "json",
				success : function(json) {
					$("#devices tbody").remove();
					testRuns = json;
					$.each(json, function(i, data) {
						console.log(data);
						$("#devices").append(
								"<tr><td>" + data.id + "</td><td>" + data.name
										+ "</td><td>" + printDate(data.updated)
										+ "</td><td>" + data.testProfileId
										+ "</td><td>" + data.testScript.name + "(" + data.testScript.id + ")"
										+ "</td><td>" + data.testTarget.name + "(" + data.testTarget.id + ")"
										+ "</td><td>" + buildControls(i, data)
										+ "</td></tr>");
					})
					$("button").button().click(function(event) {
						// Create test run from selected configuration
						var testConfig = testRuns[$(this).attr('value')];
						var testRun = {
							"userId" : testConfig.userId,
							"testConfigId" : testConfig.id
						};
						$.ajax({
							type : 'PUT',
							contentType : 'application/json',
							url : rootURL + '/testrun',
							dataType : "json",
							data : JSON.stringify(testRun),
							success : function(data, textStatus, jqXHR) {
								alert('Test has been scheduled');
							},
							error : function(jqXHR, textStatus, errorThrown) {
								alert('Error:' + textStatus);
							}
						});

					});
				}
			});
		}

		function buildControls(index, data) {
			return '<button class="run" value="' + index +'">Run</button>';
		}
	</script>
	<div id="header"></div>
	
	<div id="contents">

		<table border="1" id="devices">
			<thead>
				<tr>
					<th>id</th>
					<th>name</th>					
					<th>updated</th>
					<th>testProfileId</th>
					<th>testScriptId</th>
					<th>testTargetId</th>
					<th>controls</th>
				</tr>
			</thead>

			<tbody></tbody>

		</table>

	</div>

</body>
</html>